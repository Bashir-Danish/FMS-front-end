import{M as _,r as c,m as D,u as E,N as n,i as M}from"./index-32ea14b6.js";const U=_("auth",()=>{const m=c(),t=c([]),g="false",o=D(),l=E(),i=c(),d=c();function f(r){for(;r.length%4!==0;)r+="=";const s=r.replace(/-/g,"+").replace(/_/g,"/"),e=atob(s);try{return JSON.parse(e)}catch(a){return console.error("Error parsing JSON from JWT payload:",a),null}}async function y(){const r=document.cookie.split(";");let s={};for(const e of r){const[a,p]=e.trim().split("=");if(a==="access_token"){try{const u=p.split(".");u.length===3?(s=f(u[1])||{},i.value=s.userId):console.error("Invalid JWT token format")}catch(u){console.error("Error parsing access token from cookie:",u)}break}}}async function h(){try{const r=await n.get("/users");t.value=r.data.users}catch(r){r.response.status==401&&(M(),l.push("/login")),console.error("Error retrieving users:",r)}}async function v(){try{const r=await n.get(`/users/${i.value}`);d.value=r.data.user}catch(r){console.error("Error retrieving users:",r)}}async function w(r){const s=new FormData;s.append("name",r.name),s.append("lastName",r.lastName),s.append("email",r.email),s.append("password",r.password),s.append("userType",r.userType),s.append("imagePath",r.picture);try{const e=await n.post("/users/register",s,{headers:{"Content-Type":"multipart/form-data"}});(e==null?void 0:e.status)===201&&(t.value.push({user_id:e.data.user.user_id,name:e.data.user.name,lastName:e.data.user.lastName,email:e.data.user.email,userType:e.data.user.userType,picture:e.data.user.picture}),o.setMessage("کاربر",e.data.message,!0),o.File=[])}catch(e){o.setMessage("کاربر",e.response.data.error,!1),console.error("Error creating user:",e)}}async function T(r){const s=new FormData;s.append("name",r.name),s.append("lastName",r.lastName),s.append("email",r.email),s.append("password",r.password),s.append("userType",r.userType),s.append("imagePath",r.picture);try{try{const e=await n.put(`/users/${r.user_id}`,s,{headers:{"Content-Type":"multipart/form-data"}});if((e==null?void 0:e.status)===200){const a=t.value.findIndex(p=>p.user_id===r.user_id);a!==-1&&(t.value[a].name=e.data.user.name,t.value[a].lastName=e.data.user.lastName,t.value[a].userType=e.data.user.userType,t.value[a].picture=e.data.user.picture,t.value[a].email=e.data.user.email),console.log(e.data),o.setMessage("کاربر",e.data.message,!0)}}catch(e){console.error("Error updating user:",e)}}catch(e){console.error("Error updating user:",e)}}async function k(r){try{const s=await n.delete(`/users/${r}`);(s==null?void 0:s.status)===200&&(t.value=t.value.filter(e=>e.user_id!==r),o.setMessage("کاربر",s.data.message,!0)),console.log(s)}catch(s){o.setMessage("کاربر",s.response.data.error,!1),console.error("Error deleting user:",s)}}async function N(r,s,e){try{const a=await n.post("/users/login",{email:r,password:s,remember:e});(a==null?void 0:a.status)===200&&l.push({path:"/"})}catch(a){console.error(a.response.data.error)}}return{login:N,getAllUsers:h,createUser:w,updateUser:T,getUserDataFromCookie:y,deleteUser:k,getUserInfo:v,isLoggedIn:m,userId:i,userData:d,users:t,sideBar:g}});export{U as u};
